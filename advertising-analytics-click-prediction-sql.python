{"version":"NotebookV1","origId":1292445,"name":"advertising-analytics-click-prediction-sql","language":"python","commands":[{"version":"CommandV1","origId":1292446,"guid":"6103250e-f9b6-499b-bbed-1f92a6fe6602","subtype":"command","commandType":"auto","position":0.5,"command":"%md # Advertising Analytics Click Prediction: SQL\n####[Ad impressions with clicks dataset](https://www.kaggle.com/c/avazu-ctr-prediction/data)\n\n<img src=\"/files/img/fraud_ml_pipeline.png\" alt=\"workflow\" width=\"500\">\n\nThis is the SQL/Data exploration notebook for the series of Advertising Analytics Click Prediction notebooks.  For this stage, we will focus the Exploration of data.\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1530279080125,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":"100555","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d987fb41-aedc-41c7-9ceb-6685372501a6"},{"version":"CommandV1","origId":1292447,"guid":"54bdd86e-c349-4d61-9edc-239ca1c16f96","subtype":"command","commandType":"auto","position":1.0,"command":"impression = spark.read.parquet(\"/mnt/adtech/impression/parquet/train.csv/\")\nimpression.createOrReplaceTempView(\"impression\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"impression","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"id","nullable":true,"type":"decimal(20,0)"},{"metadata":{},"name":"click","nullable":true,"type":"integer"},{"metadata":{},"name":"hour","nullable":true,"type":"integer"},{"metadata":{},"name":"C1","nullable":true,"type":"integer"},{"metadata":{},"name":"banner_pos","nullable":true,"type":"integer"},{"metadata":{},"name":"site_id","nullable":true,"type":"string"},{"metadata":{},"name":"site_domain","nullable":true,"type":"string"},{"metadata":{},"name":"site_category","nullable":true,"type":"string"},{"metadata":{},"name":"app_id","nullable":true,"type":"string"},{"metadata":{},"name":"app_domain","nullable":true,"type":"string"},{"metadata":{},"name":"app_category","nullable":true,"type":"string"},{"metadata":{},"name":"device_id","nullable":true,"type":"string"},{"metadata":{},"name":"device_ip","nullable":true,"type":"string"},{"metadata":{},"name":"device_model","nullable":true,"type":"string"},{"metadata":{},"name":"device_type","nullable":true,"type":"integer"},{"metadata":{},"name":"device_conn_type","nullable":true,"type":"integer"},{"metadata":{},"name":"C14","nullable":true,"type":"integer"},{"metadata":{},"name":"C15","nullable":true,"type":"integer"},{"metadata":{},"name":"C16","nullable":true,"type":"integer"},{"metadata":{},"name":"C17","nullable":true,"type":"integer"},{"metadata":{},"name":"C18","nullable":true,"type":"integer"},{"metadata":{},"name":"C19","nullable":true,"type":"integer"},{"metadata":{},"name":"C20","nullable":true,"type":"integer"},{"metadata":{},"name":"C21","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1530279080347,"submitTime":1530279080139,"finishTime":1530279083371,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"Load parquet files: Dataframe and View","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2b83d179-f69e-4798-beac-7a4842855f2a"},{"version":"CommandV1","origId":1292448,"guid":"057b7007-317f-4b7d-99bb-785d5e0fd919","subtype":"command","commandType":"auto","position":2.0,"command":"%sql describe impression","commandVersion":0,"state":"finished","results":{"type":"table","data":[["id","decimal(20,0)",null],["click","int",null],["hour","int",null],["C1","int",null],["banner_pos","int",null],["site_id","string",null],["site_domain","string",null],["site_category","string",null],["app_id","string",null],["app_domain","string",null],["app_category","string",null],["device_id","string",null],["device_ip","string",null],["device_model","string",null],["device_type","int",null],["device_conn_type","int",null],["C14","int",null],["C15","int",null],["C16","int",null],["C17","int",null],["C18","int",null],["C19","int",null],["C20","int",null],["C21","int",null]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"col_name","type":"\"string\"","metadata":"{\"comment\":\"name of the column\"}"},{"name":"data_type","type":"\"string\"","metadata":"{\"comment\":\"data type of the column\"}"},{"name":"comment","type":"\"string\"","metadata":"{\"comment\":\"comment of the column\"}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Error in SQL statement: NoSuchTableException: Table or view 'impression' not found in database 'default';","error":"com.databricks.backend.common.rpc.DatabricksExceptions$SQLExecutionException: org.apache.spark.sql.catalyst.analysis.NoSuchTableException: Table or view 'impression' not found in database 'default';\n\tat org.apache.spark.sql.catalyst.catalog.SessionCatalog.requireTableExists(SessionCatalog.scala:180)\n\tat org.apache.spark.sql.catalyst.catalog.SessionCatalog.getTableMetadata(SessionCatalog.scala:399)\n\tat org.apache.spark.sql.execution.command.DescribeTableCommand.run(tables.scala:527)\n\tat org.apache.spark.sql.execution.command.ExecutedCommandExec.sideEffectResult$lzycompute(commands.scala:78)\n\tat org.apache.spark.sql.execution.command.ExecutedCommandExec.sideEffectResult(commands.scala:75)\n\tat org.apache.spark.sql.execution.command.ExecutedCommandExec.executeCollect(commands.scala:91)\n\tat org.apache.spark.sql.Dataset$$anonfun$6.apply(Dataset.scala:184)\n\tat org.apache.spark.sql.Dataset$$anonfun$6.apply(Dataset.scala:184)\n\tat org.apache.spark.sql.Dataset$$anonfun$56.apply(Dataset.scala:2908)\n\tat org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:77)\n\tat org.apache.spark.sql.Dataset.withAction(Dataset.scala:2907)\n\tat org.apache.spark.sql.Dataset.<init>(Dataset.scala:184)\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:69)\n\tat org.apache.spark.sql.SparkSession.sql(SparkSession.scala:636)\n\tat org.apache.spark.sql.SQLContext.sql(SQLContext.scala:690)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:82)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:28)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.foreach(List.scala:381)\n\tat scala.collection.TraversableLike$class.map(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.map(List.scala:285)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:28)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:130)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:234)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:215)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:188)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:183)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:39)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:221)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:39)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:215)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat scala.util.Try$.apply(Try.scala:192)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.tryExecutingCommand(DriverWrapper.scala:596)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.getCommandOutputAndError(DriverWrapper.scala:486)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:554)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInnerLoop(DriverWrapper.scala:391)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:348)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:215)\n\tat java.lang.Thread.run(Thread.java:748)\n\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:116)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:130)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:234)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:215)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:188)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:183)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:39)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:221)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:39)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:215)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat scala.util.Try$.apply(Try.scala:192)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.tryExecutingCommand(DriverWrapper.scala:596)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.getCommandOutputAndError(DriverWrapper.scala:486)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:554)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInnerLoop(DriverWrapper.scala:391)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:348)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:215)\n\tat java.lang.Thread.run(Thread.java:748)\n","workflows":[],"startTime":1530279083376,"submitTime":1530279080154,"finishTime":1530279083476,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"601","height":"589","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cc6f7f49-3076-40a1-af57-3410cfd8bc72"},{"version":"CommandV1","origId":1292449,"guid":"8a6eae34-a44e-4283-b18d-8fdc29ea6b9a","subtype":"command","commandType":"auto","position":3.5,"command":"%sql select banner_pos, count(1)\nfrom impression\ngroup by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[["0","29109590"],["1","11247282"],["2","13001"],["3","2035"],["4","7704"],["5","5778"],["7","43577"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"banner_pos","type":"\"integer\"","metadata":"{}"},{"name":"count(1)","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279083484,"submitTime":1530279080168,"finishTime":1530279091708,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"876","height":"426","xColumns":["banner_pos"],"yColumns":["count(1)"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":"100555","commandTitle":"Banner Position","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7f10adb9-b916-4d52-b5b1-ffe6691d0b2e"},{"version":"CommandV1","origId":1292450,"guid":"b7dfc8f9-5e27-41ad-a1b4-4fee05e55ced","subtype":"command","commandType":"auto","position":4.0,"command":"%sql select banner_pos,\nsum(case when click = 1 then 1 else 0 end) as click,\nsum(case when click = 0 then 1 else 0 end) as no_click\nfrom impression group by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[[0,4781901,24327689],[1,2065164,9182118],[2,1550,11451],[3,372,1663],[4,1428,6276],[5,702,5076],[7,13949,29628]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"banner_pos","type":"\"integer\"","metadata":"{}"},{"name":"click","type":"\"long\"","metadata":"{}"},{"name":"no_click","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279091712,"submitTime":1530279080185,"finishTime":1530279093346,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"660","height":"389","xColumns":["banner_pos"],"yColumns":["click","no_click"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":false},{"key":"stacked","value":true},{"key":"100_stacked","value":false}],"pieChart":[{"key":"donut","value":true}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a28bb8c2-86d5-404d-bec3-6f485eb85b2e"},{"version":"CommandV1","origId":1292451,"guid":"059ccfd5-e850-4b58-a6c9-b27e7d16703a","subtype":"command","commandType":"auto","position":4.5,"command":"%sql select banner_pos,\nsum(case when click = 1 then 1 else 0 end) / (count(1) * 1.0) as CTR\nfrom impression group by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[["0",0.16427235835338114],["1",0.18361449459522755],["2",0.11922159833858934],["3",0.1828009828009828],["4",0.1853582554517134],["5",0.12149532710280374],["7",0.3201000527801363]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"banner_pos","type":"\"integer\"","metadata":"{}"},{"name":"CTR","type":"\"decimal(38,17)\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279093348,"submitTime":1530279080198,"finishTime":1530279094478,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"698","height":"379","xColumns":["banner_pos"],"yColumns":["CTR"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"lineChart":[],"mgLine":[{"key":"param","value":"{\"top\":20,\"bottom\":50,\"area\":false,\"missing_is_hidden\":true,\"legend_target\":\".dummy\",\"animate_on_load\":false,\"transition_on_update\":false,\"colors\":[\"#1f77b4\",\"#ff7f0e\",\"#2ca02c\",\"#d62728\",\"#9467bd\",\"#8c564b\",\"#e377c2\",\"#7f7f7f\",\"#bcbd22\",\"#17becf\",\"#aec7e8\",\"#ffbb78\",\"#98df8a\",\"#ff9896\",\"#c5b0d5\",\"#c49c94\",\"#f7b6d2\",\"#c7c7c7\",\"#dbdb8d\",\"#9edae5\"],\"legend\":[\"CTR\"],\"x_label\":\"banner_pos\"}"}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":"100555","commandTitle":"CTR by banner_pos","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4d4df39b-01a2-4dd8-a6af-2d87a63d9573"},{"version":"CommandV1","origId":1292452,"guid":"83bfe221-550d-4373-8e5b-f22dd684930a","subtype":"command","commandType":"auto","position":5.0,"command":"%sql select device_type, count(1)\nfrom impression\ngroup by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[[0,2220812],[1,37304667],[2,31],[4,774272],[5,129185]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"device_type","type":"\"integer\"","metadata":"{}"},{"name":"count(1)","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279094481,"submitTime":1530279080205,"finishTime":1530279095594,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"660","height":"434","xColumns":["device_type"],"yColumns":["count(1)"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"pieChart":[{"key":"donut","value":true}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"Device Type","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e618792e-aef9-4a8b-a7f7-42abfaa1f15a"},{"version":"CommandV1","origId":1292453,"guid":"53591234-8902-4d64-a7e5-26e620536374","subtype":"command","commandType":"auto","position":5.25,"command":"%sql select device_type,\nsum(case when click = 1 then 1 else 0 end) as click,\nsum(case when click = 0 then 1 else 0 end) as no_click\nfrom impression group by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[[0,467995,1752817],[1,6311046,30993621],[2,2,29],[4,73900,700372],[5,12123,117062]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"device_type","type":"\"integer\"","metadata":"{}"},{"name":"click","type":"\"long\"","metadata":"{}"},{"name":"no_click","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279095596,"submitTime":1530279080218,"finishTime":1530279096290,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"660","height":"auto","xColumns":["device_type"],"yColumns":["click","no_click"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":false},{"key":"stacked","value":true},{"key":"100_stacked","value":false}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4b69f56a-594c-41c8-8beb-e2146fe804d6"},{"version":"CommandV1","origId":1292454,"guid":"3bbdc82b-da92-45c2-a7e2-600634b23814","subtype":"command","commandType":"auto","position":5.375,"command":"%sql select device_type,\nsum(case when click = 1 then 1 else 0 end) / (count(1) * 1.0) as CTR\nfrom impression group by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[[0,0.21073148019733323],[1,0.16917577631774597],[2,0.06451612903225806],[4,0.09544449495784427],[5,0.09384216433796493]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"device_type","type":"\"integer\"","metadata":"{}"},{"name":"CTR","type":"\"decimal(38,17)\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279096295,"submitTime":1530279080231,"finishTime":1530279096881,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"lineChart","width":"660","height":"auto","xColumns":["device_type"],"yColumns":["CTR"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"lineChart":[]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"CTR by device_type","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b3d37301-e656-4d28-86e3-1ee6e2d498fd"},{"version":"CommandV1","origId":1292455,"guid":"65886bd8-9c85-4bad-92b6-f68efdf05570","subtype":"command","commandType":"auto","position":5.5,"command":"%sql select site_category, count(1) as count\nfrom impression\ngroup by 1 having count > 200 order by count desc","commandVersion":0,"state":"finished","results":{"type":"table","data":[["50e219e0",16537234],["f028772b",12657073],["28905ebd",7377208],["3e814130",3050306],["f66779e6",252451],["75fa27f6",160985],["335d28a8",136463],["76b2941d",104754],["c0dd3be3",42090],["72722551",28216],["dedf689d",24500],["70fb0e29",24224],["0569f928",17106],["8fd0aea4",7482],["a818d37a",3230],["42a36e14",2515],["e787de0e",1209],["bcf865d9",1045],["5378d028",483],["9ccfa2ea",318]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"site_category","type":"\"string\"","metadata":"{}"},{"name":"count","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279096884,"submitTime":1530279080244,"finishTime":1530279098152,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"677","height":"497","xColumns":["site_category"],"yColumns":["count"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"histogram":[{"key":"bins","value":"20"}],"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"scatterPlot":[{"key":"loess","value":false},{"key":"bandwidth","value":0.3}],"pieChart":[{"key":"donut","value":true}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"Site Category","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f5698a2c-ab85-473c-9776-c09e349039a6"},{"version":"CommandV1","origId":1292456,"guid":"3d0e3add-03c9-47b6-934a-b3ac395cb939","subtype":"command","commandType":"auto","position":6.0,"command":"%sql select site_category,\nsum(case when click = 1 then 1 else 0 end) as click,\nsum(case when click = 0 then 1 else 0 end) as no_click\nfrom impression group by 1 order by 3 desc","commandVersion":0,"state":"finished","results":{"type":"table","data":[["50e219e0",2126350,14410884],["f028772b",2272940,10384133],["28905ebd",1534600,5842608],["3e814130",863245,2187061],["f66779e6",10019,242432],["75fa27f6",17915,143070],["335d28a8",12779,123684],["76b2941d",3170,101584],["c0dd3be3",4714,37376],["72722551",1626,26590],["70fb0e29",3298,20926],["0569f928",923,16183],["dedf689d",12593,11907],["8fd0aea4",111,7371],["a818d37a",13,3217],["42a36e14",581,1934],["e787de0e",89,1120],["bcf865d9",48,997],["5378d028",46,437],["9ccfa2ea",4,314],["c706e647",0,28],["da34532e",0,23],["74073276",2,12],["110ab22d",0,6],["a72a0145",0,2],["6432c423",0,2]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"site_category","type":"\"string\"","metadata":"{}"},{"name":"click","type":"\"long\"","metadata":"{}"},{"name":"no_click","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279098156,"submitTime":1530279080257,"finishTime":1530279099303,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"1143","height":"430","xColumns":["site_category"],"yColumns":["click","no_click"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":false},{"key":"stacked","value":true},{"key":"100_stacked","value":false}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4b5ea86e-9206-407a-8b4a-d7918b53e69e"},{"version":"CommandV1","origId":1292457,"guid":"0cfef5eb-ecf0-4a23-b9e4-bbd0c58043b2","subtype":"command","commandType":"auto","position":7.0,"command":"%sql select site_category,\nsum(case when click = 1 then 1 else 0 end) / (count(1) * 1.0) as CTR\nfrom impression group by 1 order by 2 desc","commandVersion":0,"state":"finished","results":{"type":"table","data":[["dedf689d",0.514],["3e814130",0.2830027544777475],["42a36e14",0.23101391650099404],["28905ebd",0.20801907713595713],["f028772b",0.1795786434983823],["74073276",0.14285714285714285],["70fb0e29",0.1361459709379128],["50e219e0",0.1285795435923565],["c0dd3be3",0.11199809931100024],["75fa27f6",0.11128365996832003],["5378d028",0.09523809523809525],["335d28a8",0.09364443109121154],["e787de0e",0.07361455748552523],["72722551",0.05762687836688404],["0569f928",0.05395767566935578],["bcf865d9",0.04593301435406699],["f66779e6",0.03968690953888081],["76b2941d",0.03026137426733108],["8fd0aea4",0.01483560545308741],["9ccfa2ea",0.01257861635220126],["a818d37a",0.00402476780185759],["da34532e",0.0],["110ab22d",0.0],["a72a0145",0.0],["c706e647",0.0],["6432c423",0.0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"site_category","type":"\"string\"","metadata":"{}"},{"name":"CTR","type":"\"decimal(38,17)\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Error in SQL statement: AnalysisException: ORDER BY position 3 is not in select list (valid range is [1, 2]); line 3 pos 36","error":"com.databricks.backend.common.rpc.DatabricksExceptions$SQLExecutionException: org.apache.spark.sql.AnalysisException: ORDER BY position 3 is not in select list (valid range is [1, 2]); line 3 pos 36\n\tat org.apache.spark.sql.catalyst.analysis.package$AnalysisErrorAt.failAnalysis(package.scala:42)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOrdinalInOrderByAndGroupBy$$anonfun$apply$11$$anonfun$47.apply(Analyzer.scala:1039)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOrdinalInOrderByAndGroupBy$$anonfun$apply$11$$anonfun$47.apply(Analyzer.scala:1034)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)\n\tat scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)\n\tat scala.collection.TraversableLike$class.map(TraversableLike.scala:234)\n\tat scala.collection.AbstractTraversable.map(Traversable.scala:104)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOrdinalInOrderByAndGroupBy$$anonfun$apply$11.applyOrElse(Analyzer.scala:1034)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOrdinalInOrderByAndGroupBy$$anonfun$apply$11.applyOrElse(Analyzer.scala:1028)\n\tat org.apache.spark.sql.catalyst.plans.logical.LogicalPlan$$anonfun$resolveOperators$2.apply(LogicalPlan.scala:70)\n\tat org.apache.spark.sql.catalyst.plans.logical.LogicalPlan$$anonfun$resolveOperators$2.apply(LogicalPlan.scala:70)\n\tat org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:77)\n\tat org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.resolveOperators(LogicalPlan.scala:69)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOrdinalInOrderByAndGroupBy$.apply(Analyzer.scala:1028)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOrdinalInOrderByAndGroupBy$.apply(Analyzer.scala:1027)\n\tat org.apache.spark.sql.catalyst.rules.RuleExecutor$$anonfun$execute$1$$anonfun$apply$1.apply(RuleExecutor.scala:84)\n\tat org.apache.spark.sql.catalyst.rules.RuleExecutor$$anonfun$execute$1$$anonfun$apply$1.apply(RuleExecutor.scala:81)\n\tat scala.collection.LinearSeqOptimized$class.foldLeft(LinearSeqOptimized.scala:124)\n\tat scala.collection.immutable.List.foldLeft(List.scala:84)\n\tat org.apache.spark.sql.catalyst.rules.RuleExecutor$$anonfun$execute$1.apply(RuleExecutor.scala:81)\n\tat org.apache.spark.sql.catalyst.rules.RuleExecutor$$anonfun$execute$1.apply(RuleExecutor.scala:73)\n\tat scala.collection.immutable.List.foreach(List.scala:381)\n\tat org.apache.spark.sql.catalyst.rules.RuleExecutor.execute(RuleExecutor.scala:73)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.org$apache$spark$sql$catalyst$analysis$Analyzer$$executeSameContext(Analyzer.scala:120)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.execute(Analyzer.scala:114)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed$lzycompute(QueryExecution.scala:88)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:86)\n\tat org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:69)\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:73)\n\tat org.apache.spark.sql.SparkSession.sql(SparkSession.scala:646)\n\tat org.apache.spark.sql.SQLContext.sql(SQLContext.scala:693)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:82)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:28)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.foreach(List.scala:381)\n\tat scala.collection.TraversableLike$class.map(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.map(List.scala:285)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:28)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:130)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:235)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:216)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:188)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:183)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:40)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:221)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:40)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:216)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat scala.util.Try$.apply(Try.scala:192)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.tryExecutingCommand(DriverWrapper.scala:596)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.getCommandOutputAndError(DriverWrapper.scala:486)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:554)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInnerLoop(DriverWrapper.scala:391)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:348)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:215)\n\tat java.lang.Thread.run(Thread.java:748)\n\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:116)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:130)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:235)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:216)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:188)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:183)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:40)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:221)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:40)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:216)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:601)\n\tat scala.util.Try$.apply(Try.scala:192)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.tryExecutingCommand(DriverWrapper.scala:596)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.getCommandOutputAndError(DriverWrapper.scala:486)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:554)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInnerLoop(DriverWrapper.scala:391)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:348)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:215)\n\tat java.lang.Thread.run(Thread.java:748)\n","workflows":[],"startTime":1530279099307,"submitTime":1530279080270,"finishTime":1530279100461,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"lineChart","width":"741","height":"460","xColumns":["site_category"],"yColumns":["CTR"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"lineChart":[],"histogram":[{"key":"bins","value":"20"}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":"100555","commandTitle":"CTR by site_category","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5a00fbad-55ec-4e2a-aba8-aaf1e9e0954c"},{"version":"CommandV1","origId":1292458,"guid":"88884d59-aa1a-4fb9-8062-d045a93ab4ab","subtype":"command","commandType":"auto","position":8.0,"command":"%sql select substr(hour, 7) as hour, \ncount(1)\nfrom impression \ngroup by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[["00","845178"],["01","984784"],["02","1222672"],["03","1399001"],["04","1913348"],["05","1982179"],["06","1762743"],["07","1857712"],["08","2096264"],["09","2276401"],["10","2149763"],["11","2052023"],["12","2216583"],["13","2388730"],["14","2203519"],["15","2081422"],["16","2050425"],["17","2029527"],["18","1758382"],["19","1318225"],["20","1120647"],["21","992963"],["22","907705"],["23","818771"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"hour","type":"\"string\"","metadata":"{}"},{"name":"count(1)","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279100466,"submitTime":1530279080278,"finishTime":1530279102541,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"897","height":"554","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":"100555","commandTitle":"Hour of day","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d94390c7-0754-436f-b9e5-b102152ad432"},{"version":"CommandV1","origId":1292459,"guid":"4afe6629-e4f9-4855-8b05-4b27fc997d2e","subtype":"command","commandType":"auto","position":8.5,"command":"%sql select substr(hour, 7) as hour,\nsum(case when click = 1 then 1 else 0 end) as click,\nsum(case when click = 0 then 1 else 0 end) as no_click\nfrom impression group by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[["00","152429","692749"],["01","182947","801837"],["02","215322","1007350"],["03","243705","1155296"],["04","305308","1608040"],["05","323863","1658316"],["06","296346","1466397"],["07","332884","1524828"],["08","342120","1754144"],["09","364461","1911940"],["10","346662","1803101"],["11","349740","1702283"],["12","378443","1838140"],["13","402344","1986386"],["14","391011","1812508"],["15","377174","1704248"],["16","367939","1682486"],["17","351646","1677881"],["18","295711","1462671"],["19","216183","1102042"],["20","179876","940771"],["21","159535","833428"],["22","148718","758987"],["23","140699","678072"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"hour","type":"\"string\"","metadata":"{}"},{"name":"click","type":"\"long\"","metadata":"{}"},{"name":"no_click","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279102544,"submitTime":1530279080290,"finishTime":1530279104606,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"880","height":"533","xColumns":["hour"],"yColumns":["click","no_click"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":false},{"key":"stacked","value":true},{"key":"100_stacked","value":false}]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":"100555","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5b28a4a3-f1e1-46b6-a9c1-d360e1e18ee7"},{"version":"CommandV1","origId":1292460,"guid":"153015c4-a5de-46e4-bd0d-0db8f23a7ee8","subtype":"command","commandType":"auto","position":8.75,"command":"%sql select substr(hour, 7) as hour,\nsum(case when click = 1 then 1 else 0 end) / (count(1) * 1.0) as CTR\nfrom impression group by 1 order by 1","commandVersion":0,"state":"finished","results":{"type":"table","data":[["00",0.18035135793880105],["01",0.18577373312320264],["02",0.17610773780703248],["03",0.1741993036459588],["04",0.15956741795010632],["05",0.16338736309889268],["06",0.168116395867123],["07",0.1791903158293643],["08",0.1632046345307652],["09",0.16010404142328175],["10",0.16125591518692992],["11",0.17043668613850818],["12",0.17073260960676861],["13",0.16843427260510815],["14",0.1774484358882315],["15",0.18120976909055445],["16",0.17944523696306863],["17",0.17326500214089294],["18",0.16817221741350857],["19",0.1639955242845493],["20",0.16051084775134364],["21",0.16066560385432288],["22",0.16383957342969357],["23",0.17184169932740656]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"hour","type":"\"string\"","metadata":"{}"},{"name":"CTR","type":"\"decimal(38,17)\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1530279104610,"submitTime":1530279080302,"finishTime":1530279106928,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"lineChart","width":"777","height":"391","xColumns":["hour"],"yColumns":["CTR"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{"barChart":[{"key":"grouped","value":true},{"key":"stacked","value":false},{"key":"100_stacked","value":false}],"lineChart":[]},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"CTR by hour of day","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e224239d-f65f-47c2-a6b3-8a662eb96394"},{"version":"CommandV1","origId":1292461,"guid":"d558cda9-b731-4669-8190-a012d6eca71c","subtype":"command","commandType":"auto","position":10.5,"command":"%sql select \ncount(1) as total,\n\ncount(distinct C1) as C1,\ncount(distinct banner_pos) as banner_pos,\ncount(distinct site_id) as site_id,\ncount(distinct site_domain) as site_domain,\ncount(distinct site_category) as site_category,\ncount(distinct app_id) as app_id,\ncount(distinct app_domain) as app_domain,\ncount(distinct app_category) as app_category,\ncount(distinct device_id) as device_id,\ncount(distinct device_ip) as device_ip,\ncount(distinct device_model) as device_model,\ncount(distinct device_type) as device_type,\ncount(distinct device_conn_type) as device_conn_type,\ncount(distinct C14) as C14,\ncount(distinct C15) as C15,\ncount(distinct C16) as C16,\ncount(distinct C17) as C17,\ncount(distinct C18) as C18,\ncount(distinct C19) as C19,\ncount(distinct C20) as C20,\ncount(distinct C21) as C21\nfrom impression\n","commandVersion":0,"state":"finished","results":{"type":"table","data":[["40428967","7","7","4737","7745","26","8552","559","36","2686408","6729486","8251","5","4","2626","8","9","435","4","68","172","60"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"total","type":"\"long\"","metadata":"{}"},{"name":"C1","type":"\"long\"","metadata":"{}"},{"name":"banner_pos","type":"\"long\"","metadata":"{}"},{"name":"site_id","type":"\"long\"","metadata":"{}"},{"name":"site_domain","type":"\"long\"","metadata":"{}"},{"name":"site_category","type":"\"long\"","metadata":"{}"},{"name":"app_id","type":"\"long\"","metadata":"{}"},{"name":"app_domain","type":"\"long\"","metadata":"{}"},{"name":"app_category","type":"\"long\"","metadata":"{}"},{"name":"device_id","type":"\"long\"","metadata":"{}"},{"name":"device_ip","type":"\"long\"","metadata":"{}"},{"name":"device_model","type":"\"long\"","metadata":"{}"},{"name":"device_type","type":"\"long\"","metadata":"{}"},{"name":"device_conn_type","type":"\"long\"","metadata":"{}"},{"name":"C14","type":"\"long\"","metadata":"{}"},{"name":"C15","type":"\"long\"","metadata":"{}"},{"name":"C16","type":"\"long\"","metadata":"{}"},{"name":"C17","type":"\"long\"","metadata":"{}"},{"name":"C18","type":"\"long\"","metadata":"{}"},{"name":"C19","type":"\"long\"","metadata":"{}"},{"name":"C20","type":"\"long\"","metadata":"{}"},{"name":"C21","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1530279106932,"submitTime":1530279080314,"finishTime":1530279161672,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"1039","height":"306","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":"100555","commandTitle":"cardinality of distinct column values","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f6e32b82-59d4-41f9-9193-b175e9769722"},{"version":"CommandV1","origId":1292462,"guid":"6b800236-7d01-43d0-ae8e-7122d682ded3","subtype":"command","commandType":"auto","position":10.75,"command":"display(impression.describe())","commandVersion":0,"state":"finished","results":{"type":"table","data":[["count","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967","40428967"],["mean","9223017109830744665.6428","0.16980562476404604","1.4102558253985614E7","1004.9678337069557","0.28801463069783606","Infinity","Infinity","Infinity","Infinity","Infinity",null,"Infinity","Infinity","Infinity","1.0153052389391992","0.331315019748093","18841.805450656208","318.8831170482293","60.102009482458456","2112.6011881777736","1.432499252330637","227.14437826224943","53216.848336416806","83.38228753161069"],["stddev","5.3254433666324285E18","0.3754619528653104","296.6837231341074","1.0945860540413406","0.50638202970984","NaN","NaN","NaN","NaN","NaN",null,"NaN","NaN","NaN","0.5274335995759297","0.8547935323165334","4959.456696158532","21.27250135365873","47.295381766167964","609.4123967701648","1.3262268515726012","351.02212828865186","49956.81541555247","70.2899624043865"],["min","521159373627","0","14102100","1001","0","000aa1a4","000129ff","0569f928","000d6291","001b87ae","07d7df22","00000414","0000016d","00097428","0","0","375","120","20","112","0","33","-1","1"],["max","18446743972517787388","1","14103023","1012","7","fffe8e1c","fff602a2","f66779e6","fff4213a","ff6630e0","fc6fa53d","ffffe5da","fffffaa3","fffc15b0","5","5","24052","1024","1024","2758","3","1959","100248","255"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"summary","type":"\"string\"","metadata":"{}"},{"name":"id","type":"\"string\"","metadata":"{}"},{"name":"click","type":"\"string\"","metadata":"{}"},{"name":"hour","type":"\"string\"","metadata":"{}"},{"name":"C1","type":"\"string\"","metadata":"{}"},{"name":"banner_pos","type":"\"string\"","metadata":"{}"},{"name":"site_id","type":"\"string\"","metadata":"{}"},{"name":"site_domain","type":"\"string\"","metadata":"{}"},{"name":"site_category","type":"\"string\"","metadata":"{}"},{"name":"app_id","type":"\"string\"","metadata":"{}"},{"name":"app_domain","type":"\"string\"","metadata":"{}"},{"name":"app_category","type":"\"string\"","metadata":"{}"},{"name":"device_id","type":"\"string\"","metadata":"{}"},{"name":"device_ip","type":"\"string\"","metadata":"{}"},{"name":"device_model","type":"\"string\"","metadata":"{}"},{"name":"device_type","type":"\"string\"","metadata":"{}"},{"name":"device_conn_type","type":"\"string\"","metadata":"{}"},{"name":"C14","type":"\"string\"","metadata":"{}"},{"name":"C15","type":"\"string\"","metadata":"{}"},{"name":"C16","type":"\"string\"","metadata":"{}"},{"name":"C17","type":"\"string\"","metadata":"{}"},{"name":"C18","type":"\"string\"","metadata":"{}"},{"name":"C19","type":"\"string\"","metadata":"{}"},{"name":"C20","type":"\"string\"","metadata":"{}"},{"name":"C21","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;impressions&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-854468&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>display<span class=\"ansiyellow\">(</span>impressions<span class=\"ansiyellow\">.</span>describe<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;impressions&apos; is not defined</div>","workflows":[],"startTime":1530279161676,"submitTime":1530279080326,"finishTime":1530279358526,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"943","height":"270","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"arun.pamulapati@databricks.com","latestUserId":100555,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4fa4baff-2982-47ba-a967-8260cb80e343"}],"dashboards":[{"version":"DashboardViewV1","origId":1292463,"guid":"39230964-5fdb-4347-96f4-3fd0fc4ae2d2","nuid":"cff2212e-032b-4848-9082-8370c272e898","title":"explore","width":1024,"layoutOption":{"stack":false,"grid":true},"elements":[{"guid":"03388ff0-4b17-46d0-aee1-d387c221b906","elementType":"command","elementNUID":"e224239d-f65f-47c2-a6b3-8a662eb96394","position":{"width":12,"height":6,"x":12,"y":37,"z":null},"options":null},{"guid":"47fda5f3-b842-4d27-9170-0c10c8fd4471","elementType":"command","elementNUID":"4b5ea86e-9206-407a-8b4a-d7918b53e69e","position":{"width":12,"height":6,"x":0,"y":31,"z":null},"options":null},{"guid":"596915cd-d285-4b8b-b1c8-58bb36f21204","elementType":"command","elementNUID":"4b69f56a-594c-41c8-8beb-e2146fe804d6","position":{"width":12,"height":6,"x":0,"y":19,"z":null},"options":null},{"guid":"64bc3719-59da-4644-9e3d-9bb871882288","elementType":"command","elementNUID":"5a00fbad-55ec-4e2a-aba8-aaf1e9e0954c","position":{"width":12,"height":6,"x":12,"y":25,"z":null},"options":null},{"guid":"70654bd5-0cec-4d42-9adb-633644491190","elementType":"command","elementNUID":"5b28a4a3-f1e1-46b6-a9c1-d360e1e18ee7","position":{"width":12,"height":6,"x":0,"y":43,"z":null},"options":null},{"guid":"7a9779eb-a88a-4b04-8e86-1b4765fc822f","elementType":"command","elementNUID":"a28bb8c2-86d5-404d-bec3-6f485eb85b2e","position":{"width":12,"height":6,"x":0,"y":7,"z":null},"options":null},{"guid":"8f98bb14-cf43-41f9-9bbb-30d98e0b018a","elementType":"command","elementNUID":"7f10adb9-b916-4d52-b5b1-ffe6691d0b2e","position":{"width":12,"height":7,"x":0,"y":0,"z":null},"options":null},{"guid":"afeca66c-9e77-4f58-bf65-c056607fe7ba","elementType":"command","elementNUID":"f5698a2c-ab85-473c-9776-c09e349039a6","position":{"width":12,"height":6,"x":0,"y":25,"z":null},"options":null},{"guid":"b9f889a9-76bf-4862-85bf-9a23e0adc61b","elementType":"command","elementNUID":"b3d37301-e656-4d28-86e3-1ee6e2d498fd","position":{"width":12,"height":6,"x":12,"y":13,"z":null},"options":null},{"guid":"bf39670a-5c30-4e14-8110-eaa27cd8e34a","elementType":"command","elementNUID":"d94390c7-0754-436f-b9e5-b102152ad432","position":{"width":12,"height":6,"x":0,"y":37,"z":null},"options":null},{"guid":"d0298ad2-256b-4a2d-a86a-0e18dfafd57a","elementType":"command","elementNUID":"e618792e-aef9-4a8b-a7f7-42abfaa1f15a","position":{"width":12,"height":6,"x":0,"y":13,"z":null},"options":null},{"guid":"ecb437f6-b896-4056-acf8-88eceb7fdc99","elementType":"command","elementNUID":"4d4df39b-01a2-4dd8-a6af-2d87a63d9573","position":{"width":12,"height":7,"x":12,"y":0,"z":null},"options":null}],"globalVars":{}}],"guid":"8df69a87-3f82-4a1d-a809-2b5e105318f9","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}