{"version":"NotebookV1","origId":1488544,"name":"Video Identification of Suspicious Behavior","language":"python","commands":[{"version":"CommandV1","origId":1488550,"guid":"ed794fc6-9255-46b5-aa49-903b66c76203","subtype":"command","commandType":"auto","position":9.09375,"command":"# Prefix to add prior to join\nprefix = \"dbfs:\" + targetImgPath\n\n# Read in hand-labeled data \nfrom pyspark.sql.functions import expr\nlabels = spark.read.csv(labeledDataPath, header=True, inferSchema=True)\nlabels_df = labels.withColumn(\"filePath\", expr(\"concat('\" + prefix + \"', ImageName)\")).drop('ImageName')\n\n# Read in features data (saved in Parquet format)\nfeatureDF = spark.read.parquet(imgFeaturesPath)\n\n# Create train-ing dataset by joining labels and features\ntrain = featureDF.join(labels_df, featureDF.origin == labels_df.filePath).select(\"features\", \"label\", featureDF.origin)\n\n# Validate number of images used for training\ntrain.count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">3</span><span class=\"ansired\">]: </span>451\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"labels","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"ImageName","nullable":true,"type":"string"},{"metadata":{},"name":"label","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null},{"name":"labels_df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"label","nullable":true,"type":"integer"},{"metadata":{},"name":"filePath","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null},{"name":"featureDF","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"origin","nullable":true,"type":"string"},{"metadata":{},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}}],"type":"struct"},"tableIdentifier":null},{"name":"train","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"label","nullable":true,"type":"integer"},{"metadata":{},"name":"origin","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;targetImgPath&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-4201250452481697&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansired\"># Prefix to add prior to join</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 2</span><span class=\"ansiyellow\"> </span>prefix <span class=\"ansiyellow\">=</span> <span class=\"ansiblue\">&quot;dbfs:&quot;</span> <span class=\"ansiyellow\">+</span> targetImgPath<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansired\"># Read in hand-labeled data</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> <span class=\"ansigreen\">from</span> pyspark<span class=\"ansiyellow\">.</span>sql<span class=\"ansiyellow\">.</span>functions <span class=\"ansigreen\">import</span> expr<span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;targetImgPath&apos; is not defined</div>","workflows":[],"startTime":1537422700573,"submitTime":1537422700373,"finishTime":1537422712619,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0914dea0-b964-4984-9a3c-6ae504f871f9"},{"version":"CommandV1","origId":1488551,"guid":"92bf58d4-2df5-4dac-9f5c-9017eef04867","subtype":"command","commandType":"auto","position":13.34375,"command":"from pyspark.ml.classification import LogisticRegression\n\n# Fit LogisticRegression Model\nlr = LogisticRegression(maxIter=20, regParam=0.05, elasticNetParam=0.3, labelCol=\"label\")\nlrModel = lr.fit(train)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537422712621,"submitTime":1537422700381,"finishTime":1537422755030,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":"100599","commandTitle":"Train our Logistic Regression Model","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"12bb8a38-1bcc-4c78-a7c3-70988e102e3b"},{"version":"CommandV1","origId":1488549,"guid":"1277dbac-f073-4bf2-8879-652e767a5090","subtype":"command","commandType":"auto","position":8.84375,"command":"%md \n* Read the Parquet files previously generated containing the training dataset\n* Read the hand labelled data ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1537422700353,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"Load Training Data","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"38a0b284-40b6-4cbf-be78-35f1f083217b"},{"version":"CommandV1","origId":1488546,"guid":"a149c1c2-eeac-4280-8038-f85f526f8874","subtype":"command","commandType":"auto","position":1.48828125,"command":"%run ./video_config","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":1537422700303,"submitTime":1537422700303,"finishTime":1537422700860,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"Include Video Configuration and Display Helper Functions","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"81924329-ca9c-4be7-bd7b-98ab3cab2f14"},{"version":"CommandV1","origId":1488545,"guid":"7f8e9b03-6d31-4824-a54e-960da8b627cd","subtype":"command","commandType":"auto","position":0.5,"command":"%md \n\n# Video Identification of Suspicious Behavior\n\nThis notebook will process your video data by:\n* Utilize the data processed in the `Video Identification of Suspicious Behavior: Preparation`\n* Load the training data\n* Train the model against the training data\n* Generate predictions against the test data using this model\n* Any suspicious activity in our videos?\n\nThe source data used in this notebook can be found at [EC Funded CAVIAR project/IST 2001 37540](http://homepages.inf.ed.ac.uk/rbf/CAVIAR/)\n\n<img src=\"https://databricks.com/wp-content/uploads/2018/09/mnt_raela_video_splash.png\" width=900/>\n\n### Prerequisite\n* Execute the `Video Identification of Suspicious Behavior: Preparation` to setup the images and feature datasets\n\n### Cluster Configuration\n* Suggested cluster configuration:\n * Databricks Runtime Version: `Databricks Runtime for ML` (e.g. 4.1 ML, 4.2 ML, etc.)\n * Driver: 64GB RAM Instance (e.g. `Azure: Standard_D16s_v3, AWS: r4.4xlarge`)\n * Workers: 2x 64GB RAM Instance (e.g. `Azure: Standard_D16s_v3, AWS: r4.4xlarge`)\n * Python: `Python 3`\n \n### Need to install manually\nTo install, refer to **Upload a Python PyPI package or Python Egg** [Databricks](https://docs.databricks.com/user-guide/libraries.html#upload-a-python-pypi-package-or-python-egg) | [Azure Databricks](https://docs.azuredatabricks.net/user-guide/libraries.html#upload-a-python-pypi-package-or-python-egg)\n\n* Python Libraries:\n * `opencv-python`: 3.4.2 \n \n### Libraries Already Included in Databricks Runtime for ML\nBecause we're using *Databricks Runtime for ML*, you do **not** need to install the following libraires\n* Python Libraries:\n * `h5py`: 2.7.1\n * `tensorflow`: 1.7.1\n * `keras`: 2.1.5 (Using TensorFlow backend)\n * *You can check by `import tensorflow as tf; print(tf.__version__)`*\n\n* JARs:\n * `spark-deep-learning-1.0.0-spark2.3-s_2.11.jar`\n * `tensorframes-0.3.0-s_2.11.jar`\n * *You can check by reviewing cluster's Spark UI > Environment)*","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1537422700287,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":"100599","commandTitle":"Video Identification of Suspicious Behavior: Preparation","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0c3c5d8d-d4bf-428a-ae84-f61f93d610f4"},{"version":"CommandV1","origId":1488814,"guid":"d8379f44-c516-4ccb-a8d6-92a0dd3c6df3","subtype":"script","commandType":"auto","position":2.1549479166666665,"command":"","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537422700562,"submitTime":0,"finishTime":1537422700571,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["a149c1c2-eeac-4280-8038-f85f526f8874"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"display Images and Video Helper functions","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1afa8ebb-5d53-45b0-a78e-a68fc7e22329"},{"version":"CommandV1","origId":1488558,"guid":"7a5b8a46-7ad1-49a7-ae85-7d20c641d166","subtype":"command","commandType":"auto","position":24.84375,"command":"displayImg(\"/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0017.jpg\")","commandVersion":0,"state":"finished","results":{"type":"htmlSandbox","data":"\n  <img src=\"/files//mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0017.jpg\">\n  ","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537422911600,"submitTime":1537422911588,"finishTime":1537422912808,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"384a89ce-b1a1-4077-bfc1-83ba85e3bc30"},{"version":"CommandV1","origId":1488559,"guid":"d43a56c3-ee5d-43a5-bd4f-b28a6859ff2d","subtype":"command","commandType":"auto","position":25.34375,"command":"%md ## View the Source Video\nView the source video of the suspicious images\n\n![](https://s3.us-east-2.amazonaws.com/databricks-dennylee/media/Fight_OneManDown.gif)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1537422700482,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ebd5af31-d78b-4f14-a54c-d6298e2e49fb"},{"version":"CommandV1","origId":1488556,"guid":"542dcc63-7345-428f-909d-7515079d0202","subtype":"command","commandType":"auto","position":22.84375,"command":"displayImg(\"/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0024.jpg\")","commandVersion":0,"state":"finished","results":{"type":"htmlSandbox","data":"\n  <img src=\"/files//mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0024.jpg\">\n  ","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"java.io.FileNotFoundException: /dbfs/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0017.jpg","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">ExecutionError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-4201250452481703&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>displayImg<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;/dbfs/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0017.jpg&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">&lt;command-4201250452481690&gt;</span> in <span class=\"ansicyan\">displayImg</span><span class=\"ansiblue\">(filepath)</span>\n<span class=\"ansigreen\">     17</span> <span class=\"ansired\"># displayImg(): Shows image from dbfs/cloud storage</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     18</span> <span class=\"ansigreen\">def</span> displayImg<span class=\"ansiyellow\">(</span>filepath<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 19</span><span class=\"ansiyellow\">   </span>dbutils<span class=\"ansiyellow\">.</span>fs<span class=\"ansiyellow\">.</span>cp<span class=\"ansiyellow\">(</span>filepath<span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&quot;FileStore/%s&quot;</span> <span class=\"ansiyellow\">%</span> filepath<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     20</span>   return displayHTML(&quot;&quot;&quot;\n<span class=\"ansigreen\">     21</span>   <span class=\"ansiyellow\">&lt;</span>img src<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">&quot;/files/%s&quot;</span><span class=\"ansiyellow\">&gt;</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/tmp/1537408518544-0/dbutils.py</span> in <span class=\"ansicyan\">f_with_exception_handling</span><span class=\"ansiblue\">(*args, **kwargs)</span>\n<span class=\"ansigreen\">    227</span>                     <span class=\"ansigreen\">class</span> ExecutionError<span class=\"ansiyellow\">(</span>Exception<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    228</span>                         <span class=\"ansigreen\">pass</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 229</span><span class=\"ansiyellow\">                     </span><span class=\"ansigreen\">raise</span> ExecutionError<span class=\"ansiyellow\">(</span>str<span class=\"ansiyellow\">(</span>e<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    230</span>             <span class=\"ansigreen\">return</span> f_with_exception_handling<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    231</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">ExecutionError</span>: An error occurred while calling z:com.databricks.backend.daemon.dbutils.FSUtils.cp.\n: java.io.FileNotFoundException: /dbfs/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0017.jpg\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2$$anonfun$getFileStatus$1$$anonfun$apply$15.apply(DatabricksFileSystemV2.scala:654)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2$$anonfun$getFileStatus$1$$anonfun$apply$15.apply(DatabricksFileSystemV2.scala:640)\n\tat com.databricks.s3a.S3AExeceptionUtils$.convertAWSExceptionToJavaIOException(DatabricksStreamUtils.scala:107)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2$$anonfun$getFileStatus$1.apply(DatabricksFileSystemV2.scala:640)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2$$anonfun$getFileStatus$1.apply(DatabricksFileSystemV2.scala:640)\n\tat com.databricks.logging.UsageLogging$$anonfun$recordOperation$1.apply(UsageLogging.scala:313)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:188)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:183)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2.withAttributionContext(DatabricksFileSystemV2.scala:400)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:221)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2.withAttributionTags(DatabricksFileSystemV2.scala:400)\n\tat com.databricks.logging.UsageLogging$class.recordOperation(UsageLogging.scala:298)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2.recordOperation(DatabricksFileSystemV2.scala:400)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystemV2.getFileStatus(DatabricksFileSystemV2.scala:639)\n\tat com.databricks.backend.daemon.data.client.DatabricksFileSystem.getFileStatus(DatabricksFileSystem.scala:210)\n\tat com.databricks.backend.daemon.dbutils.FSUtils$.cp(DBUtilsCore.scala:79)\n\tat com.databricks.backend.daemon.dbutils.FSUtils.cp(DBUtilsCore.scala)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:380)\n\tat py4j.Gateway.invoke(Gateway.java:295)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:226)\n\tat java.lang.Thread.run(Thread.java:748)\n</div>","workflows":[],"startTime":1537422896646,"submitTime":1537422896614,"finishTime":1537422897955,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fe183ad0-9465-40a1-8d1c-759222253478"},{"version":"CommandV1","origId":1488813,"guid":"2108eddd-e451-4160-83a6-8f141d8d0a15","subtype":"script","commandType":"auto","position":1.8216145833333333,"command":"","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Training Videos (srcVideoPath): /databricks-datasets/cctvVideos/train/\nTest Videos (srcTestVideoPath): /databricks-datasets/cctvVideos/test/\nTraining Images (targetImgPath): /mnt/tardis6/videos/cctvFrames/train/\nTest Images (targetImgTestPath): /mnt/tardis6/videos/cctvFrames/test/\nTraining Images Features (imgFeaturesPath): /mnt/tardis6/videos/cctv_features/train/\nTest Images Features (imgFeaturesTestPath): /mnt/tardis6/videos/cctv_features/test/\nLabeled Data (labeledDataPath): /databricks-datasets/cctvVideos/labels/\nTraining MP4 Videos (srcVideoMP4Path): /databricks-datasets/cctvVideos/mp4/train/\nTest MP4 Videos (srcTestVideoMP4Path): /databricks-datasets/cctvVideos/mp4/test/\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537422700540,"submitTime":1534221761451,"finishTime":1537422700561,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["a149c1c2-eeac-4280-8038-f85f526f8874"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":"100599","commandTitle":"Configure locations of videos to be extracted and images to be saved","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a42f94c4-988f-4701-b0fb-b8fbc67bdf35"},{"version":"CommandV1","origId":1488557,"guid":"d0d79f98-89ce-4f70-8a3a-6e4f689f0017","subtype":"command","commandType":"auto","position":23.84375,"command":"displayImg(\"/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0014.jpg\")","commandVersion":0,"state":"finished","results":{"type":"htmlSandbox","data":"\n  <img src=\"/files//mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0014.jpg\">\n  ","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537422903807,"submitTime":1537422903795,"finishTime":1537422905316,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d425a613-82b1-426f-8c1b-54bbc5b05900"},{"version":"CommandV1","origId":1488554,"guid":"8020a513-54a2-44ad-98c1-a0973b9b388b","subtype":"command","commandType":"auto","position":22.609375,"command":"%sql\nselect origin, probability, prob2, prediction from predictions where prediction = 1  order by prob2 desc","commandVersion":0,"state":"finished","results":{"type":"table","data":[["dbfs:/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0024.jpg",[1,2,[],[0.017307610033970747,0.9826923899660293]],0.98269236,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0014.jpg",[1,2,[],[0.03786095034365344,0.9621390496563466]],0.96213907,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0017.jpg",[1,2,[],[0.0451830428080614,0.9548169571919385]],0.95481694,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0016.jpg",[1,2,[],[0.07447960986961318,0.9255203901303868]],0.92552036,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/Fight_OneManDownframe0019.jpg",[1,2,[],[0.11471190107131549,0.8852880989286844]],0.8852881,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0027.jpg",[1,2,[],[0.129674019216907,0.870325980783093]],0.870326,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0033.jpg",[1,2,[],[0.1747258698663635,0.8252741301336365]],0.8252741,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0022.jpg",[1,2,[],[0.19848773904188566,0.8015122609581143]],0.80151224,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0023.jpg",[1,2,[],[0.21661128842070904,0.783388711579291]],0.78338873,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0034.jpg",[1,2,[],[0.21938627263970645,0.7806137273602934]],0.7806137,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0021.jpg",[1,2,[],[0.2526329698837112,0.7473670301162888]],0.747367,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0032.jpg",[1,2,[],[0.27779797195083356,0.7222020280491663]],0.722202,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0034.jpg",[1,2,[],[0.28444644925425633,0.7155535507457437]],0.7155535,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0028.jpg",[1,2,[],[0.3100204780434862,0.6899795219565138]],0.6899795,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0031.jpg",[1,2,[],[0.3225865377935367,0.6774134622064634]],0.67741346,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0025.jpg",[1,2,[],[0.3316439572092381,0.6683560427907618]],0.66835606,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/Browse1frame0040.jpg",[1,2,[],[0.33217505548519594,0.667824944514804]],0.6678249,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0026.jpg",[1,2,[],[0.3350445070164652,0.6649554929835347]],0.6649555,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0030.jpg",[1,2,[],[0.34393666454665284,0.6560633354533472]],0.6560633,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0031.jpg",[1,2,[],[0.3543534501234432,0.6456465498765568]],0.6456466,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_BehindChairframe0036.jpg",[1,2,[],[0.36441991137769275,0.6355800886223072]],0.63558006,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0020.jpg",[1,2,[],[0.3699278234886191,0.6300721765113809]],0.6300722,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0035.jpg",[1,2,[],[0.3888597550569557,0.6111402449430443]],0.61114025,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0029.jpg",[1,2,[],[0.3994196083777307,0.6005803916222693]],0.6005804,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0029.jpg",[1,2,[],[0.40740342921518774,0.5925965707848123]],0.5925966,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0033.jpg",[1,2,[],[0.40968544025218984,0.5903145597478102]],0.59031457,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0025.jpg",[1,2,[],[0.41697485325966993,0.5830251467403301]],0.58302516,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0027.jpg",[1,2,[],[0.4214390816948708,0.5785609183051292]],0.5785609,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_BehindChairframe0014.jpg",[1,2,[],[0.4430065618364966,0.5569934381635034]],0.5569934,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0026.jpg",[1,2,[],[0.4468516652720583,0.5531483347279417]],0.5531483,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0024.jpg",[1,2,[],[0.44751523495926293,0.5524847650407371]],0.55248475,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBoxframe0032.jpg",[1,2,[],[0.449015594730464,0.5509844052695361]],0.5509844,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/Rest_SlumpOnFloorframe0027.jpg",[1,2,[],[0.4578035209333389,0.542196479066661]],0.54219645,1.0],["dbfs:/mnt/tardis6/videos/cctvFrames/test/LeftBag_AtChairframe0028.jpg",[1,2,[],[0.4626993911203462,0.5373006088796538]],0.5373006,1.0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"origin","type":"\"string\"","metadata":"{}"},{"name":"probability","type":"{\"type\":\"udt\",\"class\":\"org.apache.spark.ml.linalg.VectorUDT\",\"pyClass\":\"pyspark.ml.linalg.VectorUDT\",\"sqlType\":{\"type\":\"struct\",\"fields\":[{\"name\":\"type\",\"type\":\"byte\",\"nullable\":false,\"metadata\":{}},{\"name\":\"size\",\"type\":\"integer\",\"nullable\":true,\"metadata\":{}},{\"name\":\"indices\",\"type\":{\"type\":\"array\",\"elementType\":\"integer\",\"containsNull\":false},\"nullable\":true,\"metadata\":{}},{\"name\":\"values\",\"type\":{\"type\":\"array\",\"elementType\":\"double\",\"containsNull\":false},\"nullable\":true,\"metadata\":{}}]}}","metadata":"{}"},{"name":"prob2","type":"\"float\"","metadata":"{}"},{"name":"prediction","type":"\"double\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{}},"errorSummary":"Error in SQL statement: AnalysisException: cannot resolve '`filePath`' given input columns: [predictions.rawPrediction, predictions.prob2, predictions.probability, predictions.features, predictions.origin, predictions.prediction]; line 1 pos 7;\n'Sort ['prob2 DESC NULLS LAST], true\n+- 'Project ['filePath, probability#1952, prob2#1968, prediction#1957]\n   +- Filter (prediction#1957 = cast(1 as double))\n      +- SubqueryAlias predictions\n         +- Project [origin#1944, features#1945, rawPrediction#1948, probability#1952, prediction#1957, <lambda>(probability#1952) AS prob2#1968]\n            +- Project [origin#1944, features#1945, rawPrediction#1948, probability#1952, UDF(rawPrediction#1948) AS prediction#1957]\n               +- Project [origin#1944, features#1945, rawPrediction#1948, UDF(rawPrediction#1948) AS probability#1952]\n                  +- Project [origin#1944, features#1945, UDF(features#1945) AS rawPrediction#1948]\n                     +- Relation[origin#1944,features#1945] parquet\n","error":"com.databricks.backend.common.rpc.DatabricksExceptions$SQLExecutionException: org.apache.spark.sql.AnalysisException: cannot resolve '`filePath`' given input columns: [predictions.rawPrediction, predictions.prob2, predictions.probability, predictions.features, predictions.origin, predictions.prediction]; line 1 pos 7;\n'Sort ['prob2 DESC NULLS LAST], true\n+- 'Project ['filePath, probability#1952, prob2#1968, prediction#1957]\n   +- Filter (prediction#1957 = cast(1 as double))\n      +- SubqueryAlias predictions\n         +- Project [origin#1944, features#1945, rawPrediction#1948, probability#1952, prediction#1957, <lambda>(probability#1952) AS prob2#1968]\n            +- Project [origin#1944, features#1945, rawPrediction#1948, probability#1952, UDF(rawPrediction#1948) AS prediction#1957]\n               +- Project [origin#1944, features#1945, rawPrediction#1948, UDF(rawPrediction#1948) AS probability#1952]\n                  +- Project [origin#1944, features#1945, UDF(features#1945) AS rawPrediction#1948]\n                     +- Relation[origin#1944,features#1945] parquet\n\n\tat org.apache.spark.sql.catalyst.analysis.package$AnalysisErrorAt.failAnalysis(package.scala:42)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1$$anonfun$apply$2.applyOrElse(CheckAnalysis.scala:112)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1$$anonfun$apply$2.applyOrElse(CheckAnalysis.scala:105)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$6.apply(TreeNode.scala:312)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$6.apply(TreeNode.scala:312)\n\tat org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:77)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:311)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$transformExpressionsUp$1.apply(QueryPlan.scala:96)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$transformExpressionsUp$1.apply(QueryPlan.scala:96)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$1.apply(QueryPlan.scala:108)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$1.apply(QueryPlan.scala:108)\n\tat org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:77)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpression$1(QueryPlan.scala:107)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.org$apache$spark$sql$catalyst$plans$QueryPlan$$recursiveTransform$1(QueryPlan.scala:119)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$org$apache$spark$sql$catalyst$plans$QueryPlan$$recursiveTransform$1$1.apply(QueryPlan.scala:123)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.foreach(List.scala:381)\n\tat scala.collection.TraversableLike$class.map(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.map(List.scala:285)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.org$apache$spark$sql$catalyst$plans$QueryPlan$$recursiveTransform$1(QueryPlan.scala:123)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$2.apply(QueryPlan.scala:128)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:208)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.mapExpressions(QueryPlan.scala:128)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpressionsUp(QueryPlan.scala:96)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:105)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:100)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:148)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:147)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:147)\n\tat scala.collection.immutable.List.foreach(List.scala:381)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:147)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$class.checkAnalysis(CheckAnalysis.scala:100)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:98)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:111)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed$lzycompute(QueryExecution.scala:78)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:76)\n\tat org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:68)\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:78)\n\tat org.apache.spark.sql.SparkSession.sql(SparkSession.scala:647)\n\tat org.apache.spark.sql.SQLContext.sql(SQLContext.scala:707)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:87)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:33)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.foreach(List.scala:381)\n\tat scala.collection.TraversableLike$class.map(TraversableLike.scala:234)\n\tat scala.collection.immutable.List.map(List.scala:285)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:33)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:136)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:248)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:228)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:188)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:183)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:40)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:221)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:40)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:228)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:585)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:585)\n\tat scala.util.Try$.apply(Try.scala:192)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.tryExecutingCommand(DriverWrapper.scala:580)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.getCommandOutputAndError(DriverWrapper.scala:464)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:538)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInnerLoop(DriverWrapper.scala:370)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:327)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:215)\n\tat java.lang.Thread.run(Thread.java:748)\n\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:122)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:136)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:248)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:228)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:188)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:183)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:40)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:221)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:40)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:228)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:585)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$tryExecutingCommand$2.apply(DriverWrapper.scala:585)\n\tat scala.util.Try$.apply(Try.scala:192)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.tryExecutingCommand(DriverWrapper.scala:580)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.getCommandOutputAndError(DriverWrapper.scala:464)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:538)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInnerLoop(DriverWrapper.scala:370)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:327)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:215)\n\tat java.lang.Thread.run(Thread.java:748)\n","workflows":[],"startTime":1537422759313,"submitTime":1537422700421,"finishTime":1537422773569,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":"100599","commandTitle":"Any suspicious activity in our videos?","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"97c81906-a76b-48db-b27b-e690c705b037"},{"version":"CommandV1","origId":1488555,"guid":"09b9f390-0f4e-43df-9c78-11dfd1554861","subtype":"command","commandType":"auto","position":22.7265625,"command":"%md \nView the top three most suspicious images based on `prob2` column","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1537422700429,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":100599,"commandTitle":"View Top 3 frames","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c37a575f-f7ac-4074-bff3-91633d233897"},{"version":"CommandV1","origId":1488552,"guid":"83e22076-4b8f-4746-b9d1-a358a5d45bfa","subtype":"command","commandType":"auto","position":18.84375,"command":"from pyspark.ml.classification import LogisticRegression, LogisticRegressionModel\n\n# Load Test Data\nfeaturesTestDF = spark.read.parquet(imgFeaturesTestPath)\n\n# Generate predictions on test data\nresult = lrModel.transform(featuresTestDF)\nresult.createOrReplaceTempView(\"result\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"featuresTestDF","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"origin","nullable":true,"type":"string"},{"metadata":{},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}}],"type":"struct"},"tableIdentifier":null},{"name":"result","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"origin","nullable":true,"type":"string"},{"metadata":{},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"rawPrediction","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"probability","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"prediction","nullable":false,"type":"double"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537422755032,"submitTime":1537422700394,"finishTime":1537422759251,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":"100599","commandTitle":"Generate Predictions on Test data","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6e50b61a-6a1c-4059-8cb9-93da5f9285b6"},{"version":"CommandV1","origId":1488553,"guid":"9bc000c2-6b79-4183-bb95-a2a0dc6861cd","subtype":"command","commandType":"auto","position":19.34375,"command":"from pyspark.sql.functions import udf\nfrom pyspark.sql.types import FloatType\n\n# Extract first and second elements of the StructType\nfirstelement=udf(lambda v:float(v[0]),FloatType())\nsecondelement=udf(lambda v:float(v[1]),FloatType())\n\n# Second element is what we need for probability\npredictions = result.withColumn(\"prob2\", secondelement('probability'))\npredictions.createOrReplaceTempView(\"predictions\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"predictions","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"origin","nullable":true,"type":"string"},{"metadata":{},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"rawPrediction","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"probability","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"prediction","nullable":false,"type":"double"},{"metadata":{},"name":"prob2","nullable":true,"type":"float"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537422759254,"submitTime":1537422700407,"finishTime":1537422759311,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"denny.lee@databricks.com","latestUserId":"100599","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c07de8ee-93c8-4a67-b7be-3c8501f9689c"}],"dashboards":[],"guid":"ce8f7820-20c4-4df0-9bd3-ea41bfffce40","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}